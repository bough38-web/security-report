
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Security Watch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Pretendard', sans-serif; background-color: #f1f5f9; color: #1e293b; }
        .glass-card { background: white; border: 1px solid #e2e8f0; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); transition: all 0.2s; }
        .glass-card:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); border-color: #3b82f6; }
        #loader { position: fixed; inset: 0; background: white; z-index: 99; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    </style>
</head>
<body>

    <div id="loader">
        <div class="w-12 h-12 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-4"></div>
        <p class="text-slate-500 font-bold">구글 뉴스 분석 중...</p>
    </div>

    <nav class="bg-slate-900 text-white h-16 sticky top-0 z-50 px-6 flex items-center justify-between shadow-lg">
        <div class="flex items-center gap-2 font-bold text-lg">
            <i class="ph-fill ph-globe-hemisphere-west text-blue-400"></i> Global Security Watch
        </div>
        <div class="text-xs bg-slate-800 px-3 py-1 rounded-full text-slate-300 border border-slate-700 flex items-center gap-2">
            <span class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></span> Google News Live
        </div>
    </nav>

    <div class="max-w-7xl mx-auto p-6 space-y-6">
        
        <div class="glass-card p-6 bg-gradient-to-r from-slate-800 to-slate-900 text-white border-none">
            <h2 class="font-bold text-lg mb-3 flex items-center gap-2">
                <i class="ph-duotone ph-cpu"></i> AI Risk Analysis
            </h2>
            <p id="ai-msg" class="text-sm text-slate-300 bg-white/10 p-4 rounded-xl backdrop-blur-sm border border-white/10 leading-relaxed">
                데이터 분석 중...
            </p>
            <div id="quick-btns" class="mt-4 flex flex-wrap gap-2"></div>
        </div>

        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="glass-card p-5 border-l-4 border-blue-500">
                <p class="text-xs text-slate-500 font-bold uppercase">Total News</p>
                <h3 id="kpi-total" class="text-3xl font-bold text-slate-800 mt-2">-</h3>
            </div>
            <div class="glass-card p-5 border-l-4 border-red-500 bg-red-50/20">
                <p class="text-xs text-red-600 font-bold uppercase">Critical</p>
                <h3 id="kpi-red" class="text-3xl font-bold text-red-600 mt-2">-</h3>
            </div>
            <div class="glass-card p-5 border-l-4 border-amber-500">
                <p class="text-xs text-amber-600 font-bold uppercase">Warning</p>
                <h3 id="kpi-amber" class="text-3xl font-bold text-amber-600 mt-2">-</h3>
            </div>
            <div class="glass-card p-5 border-l-4 border-green-500">
                <p class="text-xs text-green-600 font-bold uppercase">Key Issue</p>
                <h3 id="kpi-kw" class="text-lg font-bold text-green-700 mt-3 truncate">-</h3>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="space-y-6">
                <div class="glass-card p-5 sticky top-24">
                    <h3 class="font-bold text-sm text-slate-700 mb-4 pb-2 border-b">Dashboard Control</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs font-bold text-slate-500 block mb-1">Filter by Keyword</label>
                            <select id="sel-kw" class="w-full p-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:border-blue-500 cursor-pointer"><option value="all">View All</option></select>
                        </div>
                        <div>
                            <label class="text-xs font-bold text-slate-500 block mb-1">Search</label>
                            <div class="relative">
                                <i class="ph-bold ph-magnifying-glass absolute left-3 top-3 text-slate-400"></i>
                                <input id="inp-search" type="text" class="w-full pl-9 pr-3 py-2.5 bg-slate-50 border border-slate-200 rounded-lg text-sm outline-none focus:border-blue-500" placeholder="키워드 검색...">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="glass-card p-5">
                    <h3 class="font-bold text-sm text-slate-700 mb-4">Risk Distribution</h3>
                    <div class="h-48 relative"><canvas id="chart"></canvas></div>
                </div>
            </div>

            <div class="lg:col-span-2">
                <div class="flex justify-between items-end mb-4 px-1">
                    <h3 class="font-bold text-lg text-slate-800">Latest Feed</h3>
                    <span id="cnt" class="text-xs font-bold bg-white border px-2 py-1 rounded text-slate-500 shadow-sm">0 items</span>
                </div>
                <div id="list" class="space-y-3"></div>
            </div>
        </div>
        
        <footer class="mt-12 py-8 text-center text-xs text-slate-400 border-t">
            &copy; 2025 Global Security Watch. Powered by Google News RSS.
        </footer>
    </div>

    <script>
        // ★ Base64 디코딩 (깨짐 방지 기술) ★
        const B64_DATA = "W3sia2V5d29yZCI6ICLsi5zsiqTthZwiLCAidGl0bGUiOiAi6rWs6riAIOuJtOyKpCDsl7DqsrAg7Iuk7YyoICjsg5jtlIwg642w7J207YSwKSIsICJsaW5rIjogIiMiLCAiZGF0ZSI6ICItIiwgInJpc2siOiAiR1JFRU4ifV0=";
        const B64_KW = "WyJLVO2FlOugiOy6hSIsICJTS+yJtOuNlOyKpCIsICLsl5DsiqTsm5AiLCAi67O07JWIIOyCrOqzoCIsICLtlbTtgrkiLCAi6rCc7J247KCV67O0IOycoOy2nCIsICLsgrDsl4Ug7J6s7ZW0Il0=";
        
        // 유니코드 지원 디코더
        function decodeData(str) {
            try {
                return JSON.parse(new TextDecoder().decode(Uint8Array.from(atob(str), c => c.codePointAt(0))));
            } catch (e) { console.error(e); return []; }
        }

        let rawData = [], keywords = [], filtered = [], myChart = null;

        window.onload = () => {
            rawData = decodeData(B64_DATA);
            keywords = decodeData(B64_KW);
            filtered = [...rawData];

            setTimeout(() => { document.getElementById('loader').style.display = 'none'; }, 600);
            init();
        };

        function init() {
            const btnArea = document.getElementById('quick-btns');
            const sel = document.getElementById('sel-kw');
            
            keywords.forEach(k => {
                const opt = document.createElement('option');
                opt.value = k; opt.textContent = k;
                sel.appendChild(opt);
                
                const btn = document.createElement('button');
                btn.className = "px-3 py-1.5 rounded-lg text-xs font-bold bg-slate-700 text-slate-300 hover:bg-blue-500 hover:text-white transition-colors border border-slate-600";
                btn.textContent = k;
                btn.onclick = () => { sel.value = k; update(); };
                btnArea.appendChild(btn);
            });
            update();
        }

        function update() {
            const kw = document.getElementById('sel-kw').value;
            const search = document.getElementById('inp-search').value.toLowerCase();

            filtered = rawData.filter(d => {
                return (kw === 'all' || d.keyword === kw) && d.title.toLowerCase().includes(search);
            });
            render();
        }

        function render() {
            // KPI
            document.getElementById('kpi-total').textContent = filtered.length;
            const red = filtered.filter(d=>d.risk==='RED').length;
            document.getElementById('kpi-red').textContent = red;
            document.getElementById('kpi-amber').textContent = filtered.filter(d=>d.risk==='AMBER').length;
            
            if(filtered.length > 0) {
                const c = {};
                filtered.forEach(d=>c[d.keyword]=(c[d.keyword]||0)+1);
                const top = Object.keys(c).reduce((a,b)=>c[a]>c[b]?a:b);
                document.getElementById('kpi-kw').textContent = top;
            } else {
                document.getElementById('kpi-kw').textContent = "-";
            }

            // AI Summary
            const msg = document.getElementById('ai-msg');
            if(red > 0) {
                msg.innerHTML = `⚠️ 현재 <span class="text-red-400 font-bold">심각(Critical) 등급 이슈가 ${red}건</span> 감지되었습니다.<br>해킹, 유출, 사고 등 주요 보안 위협 키워드가 포함된 기사를 우선적으로 확인하시기 바랍니다.`;
            } else {
                msg.innerHTML = `✅ 분석 결과, 현재 특이한 보안 위협 징후는 발견되지 않았습니다.<br>모든 시스템 및 모니터링 지표가 정상 범위 내에 있습니다.`;
            }

            // List
            const list = document.getElementById('list');
            list.innerHTML = '';
            document.getElementById('cnt').textContent = `${filtered.length} items`;

            if(filtered.length === 0) {
                list.innerHTML = '<div class="p-12 text-center border-2 border-dashed border-slate-200 rounded-xl text-slate-400">데이터가 없습니다.</div>';
            } else {
                filtered.forEach(d => {
                    const el = document.createElement('a');
                    el.href = d.link; el.target = "_blank";
                    el.className = "block glass-card p-5 group no-underline relative hover:border-blue-400 transition-all";
                    
                    let badgeClass = "bg-green-100 text-green-700 border-green-200";
                    if(d.risk === 'RED') badgeClass = "bg-red-100 text-red-700 border-red-200";
                    if(d.risk === 'AMBER') badgeClass = "bg-amber-100 text-amber-700 border-amber-200";

                    el.innerHTML = `
                        <div class="flex justify-between items-start gap-4">
                            <div class="flex-1">
                                <div class="flex gap-2 mb-2 items-center flex-wrap">
                                    <span class="text-[10px] px-2 py-0.5 rounded font-bold uppercase border ${badgeClass}">${d.risk}</span>
                                    <span class="text-[10px] bg-slate-100 text-slate-600 px-2 py-0.5 rounded border border-slate-200 font-bold tracking-wide">${d.keyword}</span>
                                    <span class="text-xs text-slate-400 font-mono flex items-center gap-1"><i class="ph-bold ph-calendar-blank"></i> ${d.date}</span>
                                </div>
                                <h4 class="font-bold text-slate-800 text-base leading-snug group-hover:text-blue-600 transition-colors">
                                    ${d.title}
                                </h4>
                            </div>
                            <div class="bg-slate-50 p-2 rounded-lg group-hover:bg-blue-50 transition-colors">
                                <i class="ph-bold ph-arrow-up-right text-slate-400 group-hover:text-blue-500 text-lg"></i>
                            </div>
                        </div>
                    `;
                    list.appendChild(el);
                });
            }

            // Chart
            if(myChart) myChart.destroy();
            const counts = {RED:0, AMBER:0, GREEN:0};
            filtered.forEach(d => {
                if(counts[d.risk]!==undefined) counts[d.risk]++;
                else counts.GREEN++;
            });

            const ctx = document.getElementById('chart');
            myChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Critical', 'Warning', 'Safe'],
                    datasets: [{
                        data: [counts.RED, counts.AMBER, counts.GREEN],
                        backgroundColor: ['#ef4444', '#f59e0b', '#22c55e'],
                        borderWidth: 0
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    cutout: '75%', 
                    plugins: { legend: { position: 'right', labels: { usePointStyle: true, boxWidth: 8, font: { family: 'Pretendard' } } } } 
                }
            });
        }

        document.getElementById('sel-kw').addEventListener('change', update);
        document.getElementById('inp-search').addEventListener('input', update);
    </script>
</body>
</html>
